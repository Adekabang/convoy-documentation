# Deploying Convoy

::: danger
Convoy is not free software. Production use of Convoy is prohibited. You will need an active subscription or explicit permission from Performave.
:::

## Minimum System Requirements


::: info
This documentation is still a work in progress. Other information like generating a user, more optimization commands for production, etc will come out soon.
:::

## Compatbility

### Supported Operating Systems

| Operating System        | Supported           | Notes |
| ----------------------- |:-------------------:| ----- |
| Debian 11               | :white_check_mark:  |       |
| Ubuntu 20.04            | :white_check_mark:  |       |
| Ubuntu 22.04            | :white_check_mark:  |       |

### Supported Proxmox Versions

| ProxmoxVE Version       | Convoy Version      | Notes |
| ----------------------- | ------------------- | ----- |
| 7.2-7                   | v1.1.0-beta         |       |

## Install Docker

::: danger
There's ZERO support from Performave if you don't install Convoy with Docker.
:::

Convoy uses Docker for everything. The source code comes with a Docker configuration that will ensure that everything works. It's possible to use cPanel, but it'll be ABSOLUTELY hard. You'll be spending more time debugging configuration errors with cPanel than working at a retail job for enough money to buy a virtual machine to run Convoy smoothly.

```sh
curl -fsSL https://get.docker.com/ | sh
```

## Download Files

First, create the folder where the panel will be stored in and change your current directory to that newly created folder.

```sh
mkdir -p /var/ww/convoy
cd /var/www/convoy
```

Once you've created the directory and moved into it, you'll need to download the panel. Then, you'll need to unpack the archive. Next, you'll need to set the correct permissions on the `storage/` and `bootstrap/cache/` directories.

```sh
curl -Lo panel.tar.gz https://github.com/convoypanel/panel/releases/latest/download/panel.tar.gz
tar -xzvf panel.tar.gz
chmod -R 755 storage/* bootstrap/cache/
```

## Installation

Now you have all the files, it's time to configure Convoy to run.

### Environment Variables

Make a new environment file `cp .env.example .env`

Edit the following variables
```
APP_ENV=production
...
APP_DEBUG=false
...
DB_HOST=database
...
DB_DATABASE=DATABASE_NAME
DB_USERNAME=CUSTOM_USER_NAME
DB_PASSWORD=SUPER_SUPER_SECRET_PASS
DB_ROOT_PASSWORD=THIS_PASSWORD_DOESNT_MATCH_THE_ONE_ABOVE
...
CACHE_DRIVER=redis
...
QUEUE_CONNECTION=redis
SESSION_DRIVER=redis
...
REDIS_HOST=redis
REDIS_PASSWORD=SUPER_SECURE_PASSWORD
REDIS_PORT=6379
...
```

### Permissions

Allow Convoy to log output generated by the application.

`chmod o+w ./storage/ -R`

### Preparing for production

Start the base Docker containers

`docker compose up -d nginx php workspace redis database`

Enter the workspace container

`docker compose exec workspace bash`

Run the installation commands

::: warning
If you receive an error running the Composer command regarding a zip extension, run `apt install unzip` in the workspace container.
:::

```
composer install --optimize-autoloader --no-dev
npm install
npm run build
php artisan key:generate
php artisan migrate
php artisan route:cache
php artisan config:cache
```

Exit the container by holding `CNTRL + D`

### Finalizing

Restart the containers

`docker compose restart`

Start the queue worker

`docker compose up -d`


### Adding a user

Enter the workspace container
`docker compose exec workspace bash`

Run PHP Repl
`php artisan tinker`

Create the user
`User::create(['name' => 'YOUR_NAME', 'email' => 'YOUR_EMAIL@advinservers.gov', 'password' => Hash::make('YOUR_SECURE_PASSWORD'), 'root_admin' => 1])`

Exit out of Repl
`exit`

Exit Docker container
CNTRL + D
